<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ¼”å‡ºè¯¦æƒ… -->
  <view wx:else class="detail-container">
    <!-- æ¼”å‡ºæµ·æŠ¥ -->
    <view class="poster-section">
      <image 
        src="{{eventDetail.poster}}" 
        class="poster-image" 
        mode="aspectFill"
        bindtap="onPosterTap"
      ></image>
      <view class="poster-overlay">
        <view class="status-tag {{eventDetail.status}}">
          <text wx:if="{{eventDetail.status === 'onSale'}}">åœ¨å”®</text>
          <text wx:if="{{eventDetail.status === 'upcoming'}}">å³å°†å¼€å”®</text>
          <text wx:if="{{eventDetail.status === 'soldOut'}}">å”®ç½„</text>
        </view>
      </view>
    </view>

    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="info-section">
      <view class="title">{{eventDetail.title}}</view>
      <view class="tags">
        <text wx:for="{{eventDetail.tags}}" wx:key="index" class="tag">{{item}}</text>
      </view>
      
      <view class="meta-info">
        <view class="meta-item">
          <text class="meta-label">ğŸ• æ—¶é—´</text>
          <text class="meta-value">{{eventDetail.date}} {{eventDetail.time}}</text>
        </view>
        <view class="meta-item">
          <text class="meta-label">ğŸ“ åœ°ç‚¹</text>
          <text class="meta-value" bindtap="onAddressTap">{{eventDetail.venue}}</text>
        </view>
        <view class="meta-item">
          <text class="meta-label">â±ï¸ æ—¶é•¿</text>
          <text class="meta-value">çº¦{{eventDetail.duration}}åˆ†é’Ÿ</text>
        </view>
        <view class="meta-item">
          <text class="meta-label">ğŸ­ æ¼”å‘˜</text>
          <text class="meta-value">{{eventDetail.performers.join('ã€')}}</text>
        </view>
      </view>

      <view class="seat-info">
        <text class="remaining-seats">å‰©ä½™{{eventDetail.remainingSeats}}/{{eventDetail.totalSeats}}å¸­</text>
      </view>
    </view>

    <!-- æ¼”å‡ºä»‹ç» -->
    <view class="description-section">
      <view class="section-title">æ¼”å‡ºä»‹ç»</view>
      <text class="description-text">{{eventDetail.description}}</text>
    </view>

    <!-- ä»·æ ¼é€‰æ‹© -->
    <view class="price-section">
      <view class="section-title">é€‰æ‹©ç¥¨ä»·</view>
      <view class="price-list">
        <view 
          wx:for="{{eventDetail.priceOptions}}" 
          wx:key="id"
          class="price-option {{selectedPriceOption.id === item.id ? 'selected' : ''}} {{item.remainingCount === 0 ? 'sold-out' : ''}}"
          bindtap="onPriceOptionTap"
          data-id="{{item.id}}"
        >
          <view class="price-info">
            <view class="price-name">{{item.name}}</view>
            <view class="price-desc" wx:if="{{item.description}}">{{item.description}}</view>
          </view>
          <view class="price-right">
            <view class="price-amount">
              <text class="current-price" style="color: {{theme.colors.primary}}">Â¥{{item.price}}</text>
              <text wx:if="{{item.originalPrice}}" class="original-price">Â¥{{item.originalPrice}}</text>
            </view>
            <text class="remaining-count">ä½™{{item.remainingCount}}å¼ </text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ•°é‡é€‰æ‹© -->
    <view class="quantity-section">
      <view class="section-title">è´­ä¹°æ•°é‡</view>
      <view class="quantity-selector">
        <view class="quantity-btn" bindtap="onQuantityChange" data-change="-1">-</view>
        <text class="quantity-value">{{quantity}}</text>
        <view class="quantity-btn" bindtap="onQuantityChange" data-change="1">+</view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨è´­ä¹°æ  -->
  <view wx:if="{{!loading}}" class="bottom-bar">
    <view class="price-summary">
      <text class="total-price" style="color: {{theme.colors.primary}}">Â¥{{selectedPriceOption.price * quantity}}</text>
      <text class="quantity-text">{{quantity}}å¼ </text>
    </view>
    <button 
      class="purchase-btn" 
      bindtap="onPurchaseTap"
      style="background-color: {{theme.colors.primary}}"
      disabled="{{eventDetail.status !== 'onSale'}}"
    >
      {{eventDetail.status === 'onSale' ? 'ç«‹å³è´­ä¹°' : (eventDetail.status === 'upcoming' ? 'å³å°†å¼€å”®' : 'å·²å”®ç½„')}}
    </button>
  </view>

  <!-- è´­ä¹°å¼¹çª— -->
  <view wx:if="{{showPurchaseModal}}" class="modal-overlay" bindtap="onClosePurchaseModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">å¡«å†™è´­ç¥¨ä¿¡æ¯</text>
        <text class="modal-close" bindtap="onClosePurchaseModal">âœ•</text>
      </view>
      
      <view class="modal-body">
        <view class="order-summary">
          <text class="event-title">{{eventDetail.title}}</text>
          <text class="event-time">{{eventDetail.date}} {{eventDetail.time}}</text>
          <text class="ticket-info">{{selectedPriceOption.name}} Ã— {{quantity}}</text>
          <text class="total-amount" style="color: {{theme.colors.primary}}">Â¥{{selectedPriceOption.price * quantity}}</text>
        </view>

        <view class="form-section">
          <view class="form-item">
            <text class="form-label">è”ç³»äººå§“å</text>
            <input 
              class="form-input" 
              placeholder="è¯·è¾“å…¥å§“å" 
              value="{{userInfo.name}}"
              bindinput="onUserInfoInput"
              data-field="name"
            />
          </view>
          
          <view class="form-item">
            <text class="form-label">æ‰‹æœºå·ç </text>
            <input 
              class="form-input" 
              placeholder="è¯·è¾“å…¥æ‰‹æœºå·" 
              type="number"
              value="{{userInfo.phone}}"
              bindinput="onUserInfoInput"
              data-field="phone"
            />
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <button 
          class="confirm-btn" 
          bindtap="onConfirmPurchase"
          loading="{{purchasing}}"
          disabled="{{purchasing}}"
          style="background-color: {{theme.colors.primary}}"
        >
          {{purchasing ? 'å¤„ç†ä¸­...' : 'ç¡®è®¤è´­ä¹°'}}
        </button>
      </view>
    </view>
  </view>
</view>